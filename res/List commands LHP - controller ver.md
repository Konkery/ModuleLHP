# СПИСОК КОМАНД СЛУЖБЫ DEVICES MANAGER УРОВНЯ - CONTROLLER
---

## СПИСОК GET КОМАНД

### dm-deviceslist-get
---
Команда запрашивает текущие значения системных параметров контроллера, такие как:<br>
    [sensor_ch_list]   - список сенсоров и их измерительных каналов;<br>
    [actuator_ch_list] - список актуаторов и их управленческих каналов;<br>
Формат команды:
```json
{
    "com":   "dm-deviceslist-get",
    "arg":   []
}
```
Параметры команды:<br>
    "com":   - поле должно содержать идентификатор команды "dm-deviceslist-get";<br>
    "arg":   - поле должно содержать пустой массив;<br>
Формат возвращаемых данных:
```json
{
    "timestamp": 122465768,
    "metadata":  {
        "type"    : "plc",
        "services": "dm",
        "crc"     : 0x453ac5
    },
    "value":    {
                    "sensor":   [
                        "<articleDevS1>-<idDev>-<idCh>",
                        "<articleDevS2>-<idDev>-<idCh>",
                        "<articleDevSN>-<idDev>-<idCh>"
                        ],
                    "actuator": [
                        "<articleDevA1>-<idDev>-<idCh>",
                        "<articleDevA2>-<idDev>-<idCh>",
                        "<articleDevAN>-<idDev>-<idCh>"
                        ]
    }
}
```
`timestamp`- содержит системное время контроллера;<br>
`metadata` - содержит метаданные LHP протокола, такие как:<br>
____`type`      - тип устройства ('plc' - контроллер Horizon),<br>
____`services`  - имя службы отправившее сообщение,<br>
____`crc`       - контрольная сумма LHP пакета.<br>
`value`    - содержит список каналов сенсоров/актуаторов/шин и др устройств PLC<br>
____`sensor`    - массив идентификаторов измерительных каналов конкретного сенсора<br>
____`actuator`  - массив идентификаторов управленческих каналов конкретного актуатора<br>
<br>
Формат идентификатора канала:<br>
`articleDev-idDev-idCh`, где<br>
`articleDev` - артикул устройств в формате Horizon фреймворк `02-501-0108-201-0001`,<br>
<br>
ВАЖНОЕ ЗАМЕЧАНИЕ: в стандарте формирования кода артикула устройств в качестве разделителя<br>
используется символ `-`, но данный символ запрещен в протоколе LHP в полях хранящих<br>
идентификаторы каналов, поэтому при формировании значения массива `sensor` и `actuator` в<br>
значениях `articleDev` данный символ заменен на `#`. При получении пакета на стороне сервера<br>
он будет восстановлен.

## СПИСОК SET КОМАНД
---

### dm-actuator-set
---
Команда задает новое значение актуатору переданное от сервера [Node-Red].
Более подробно см. документацию к службе [DEVICESMANAGER]. Новое значение относится не к актуатору
в целом, а непосредственно к конкретному каналу актуатора.<br>
Формат команды:
```json
{
    "id_dev": 25,
    "id_ch": "1",
    "com":   "dm-actuator-set",
    "arg":   ["90"]
}
```
Параметры команды:<br>
    "id_dev" - поле должно содержать уникальный идентификатор устройства на контроллере нижнего уровня;<br>
    "id_ch"  - поле должно содержать уникальный идентификатор канала;<br>
    "com":   - поле должно содержать идентификатор команды "dm-actuator-set";<br>
    "arg":   - поле должно содержать набор значений, упакованных в массив, необходимые для инициализации актуатора;<br>
Аргументы команды должны содержать значения которые необходимо передать актуатору, в примере аргумент содержит
новое значение угла сервопривода.

## СПИСОК SUBSCRIPTION КОМАНД
---

### dm-sub-service
---
Команда оформляет подписку сервера [Node-Red] на ВСЕ сервисы и сообщения службы [DEVICESMANAGER]. После осуществления
подписки, становиться возможным получения ответов от службы которые генерируются автоматически сервисными уровнями
после адресной подписки на данный сервисный уровень, а также. Без общей (данной) подписки невозможно обратится к
актуатором и другим сервисным уровням службы, так как они будут игнорироваться. Общая механика работы со службой
заключается в следующем порядке:<br>
1. оформить подписку к сервису в "целом";
2. оформить подписку на конкретный сервисный уровень службы;<br>
Более подробно см. документацию к службе [DEVICESMANAGER];<br>
Формат команды:
```json
{
    "com":      "dm-sub-service",
    "arg":      []
}
```
Параметры команды:<br>
    "id_dev" - поле должно содержать значение -1 (минус единица);<br>
    "id_ch"  - поле должно содержать значение -1 (минус единица);<br>
    "com":   - поле должно содержать идентификатор команды "dm-sensor-sub";<br>
    "arg":   - поле должно содержать пустой массив, аргументы у команды не предусмотрены;<br>

### dm-sub-sensorall
---
Команда оформляет подписку сервера [Node-Red] на ВСЕ сервисы и сообщения службы [DEVICESMANAGER]. Данная подписка активирует
**автоматическую периодическую** отправку данных со всех измерительных каналов всех сенсоров контроллера нижнего уровня.
Также после осуществления подписки, становиться возможна отправка команд актуатором контроллера, которые также обслуживает
служба [DEVICESMANAGER]. Без общей подписки, команды актуатором и другим сервисным уровням службы, будут игнорироваться.
Более подробно см. документацию к службе [DEVICESMANAGER].<br>
Формат команды:
```json
{
    "id_dev":   -1,
    "id_ch":    -1,
    "com":      "dm-sub-sensorall",
    "arg":      []
}
```
Параметры команды:<br>
    "id_dev" - поле должно содержать значение -1 (минус единица);<br>
    "id_ch"  - поле должно содержать значение -1 (минус единица);<br>
    "com":   - поле должно содержать идентификатор команды "dm-sensor-sub";<br>
    "arg":   - поле должно содержать пустой массив, аргументы у команды не предусмотрены;<br>

### dm-unsub-all
---
Команда отменяет подписку сервера [Node-Red] на все измерительные каналы датчиков контроллера
нижнего уровня. После отработки данной команды, на сервер со стороны контроллера должны прекратить поступать данные от измерительных каналов контроллера, если ранее была оформлена подписка на которые был подписан сервер.
Если подписка ранее не была оформлена, то команда на стороне контроллера будет проигнорирована. Более подробно
см. документацию к службе [DEVICESMANAGER].<br>
Формат команды:
```json
{
    "id_dev":   -1,
    "id_ch":    -1,
    "com":      "dm-sensor-unsub",
    "arg":      []
}
```
Параметры команды:<br>
    "id_dev" - поле должно содержать значение -1 (минус единица);<br>
    "id_ch"  - поле должно содержать значение -1 (минус единица);<br>
    "com":   - поле должно содержать идентификатор команды "dm-sensor-unsub";<br>
    "arg":   - поле должно содержать пустой массив, аргументы у команды не предусмотрены;<br>
<br>


# СПИСОК КОМАНД СЛУЖБЫ PROCESS УРОВНЯ - CONTROLLER
---

## СПИСОК GET КОМАНД
---

### proc-get-systemdata
---
Команда запрашивает текущие значения системных параметров контроллера, такие как:<br>
    [name]          - сетевое имя контроллера;<br>
    [MAC]           - сетевой MAC адрес wifi/eth интерфейса контроллера;<br>
    [IP]            - сетевой IP адрес wifi/eth интерфейса контроллера;<br>
Формат команды:
```json
{
    "com":   "proc-get-systemdata",
    "arg":   []
}
```
Параметры команды:<br>
    "com":   - поле должно содержать идентификатор команды "proc-get-systemdata";<br>
    "arg":   - поле должно содержать пустой массив;<br>

### proc-get-time
---
Команда запрашивает текущие значения системного времени, такие как:<br>
    [current_time]  - текущее значение системного JS времени контроллера;<br>
    [current_tick]  - текущее значение "тиков" контроллера, возвращаемое функцией Espruino **getTime()**
Формат команды:
```json
{
    "com":   "proc-get-time",
    "arg":   []
}
```
Параметры команды:<br>
    "com":   - поле должно содержать идентификатор команды "proc-get-time";<br>
    "arg":   - поле должно содержать пустой массив;<br>

## СПИСОК SET КОМАНД
---

### proc-set-modulename
---
Команда задает новое значение атрибуту [name] контроллера. Данная команда не только обновляет динамическое
значение атрибута, но и обновляет значение в конфигурационном файле контроллера.<br>
Формат команды:
```json
{
    "com":   "proc-set-modulename",
    "arg":   ["newName"]
}
```
Параметры команды:<br>
    "com":   - поле должно содержать идентификатор команды "proc-set-modulename";<br>
    "arg":   - поле должно содержать одно значение, упакованное в массив, содержащее новое значение атрибута [name];<br>